<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Step two</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension ms-toolsai.jupyter */
/* These classnames are inherited from bootstrap, but are present in most notebook renderers */

.alert {
    width: auto;
    padding: 1em;
    margin-top: 1em;
    margin-bottom: 1em;
}
.alert > *:last-child {
    margin-bottom: 0;
}
#preview > .alert:last-child {
    /* Prevent this being set to zero by the default notebook stylesheet */
    padding-bottom: 1em;
}

.alert-success {
    /* Note there is no suitable color available, so we just copy "info" */
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-info {
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-warning {
    background-color: var(--theme-warning-background);
    color: var(--theme-warning-foreground);
}
.alert-danger {
    background-color: var(--theme-error-background);
    color: var(--theme-error-foreground);
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="step-two">Step two</h1>
<p>In this step we wiil create a CryptoCurrency market price tracker. We will use redis as a database and python as a programming language.</p>
<p>also we will use docker to run redis and python-Django.</p>
<p>use redis cache to store data and use Django to get data from API and show it to user.</p>
<p>also use docker Volumes to store data in host machine.</p>
<p>also we nedd to create config file for redis annd Django.</p>
<p>config file contains :</p>
<ul>
<li>
<p>Django server port</p>
</li>
<li>
<p>redis keys expire time : default 5 minutes</p>
</li>
<li>
<p>CoinAPI API key</p>
</li>
<li>
<p><a href="#step-two">Step two</a></p>
<ul>
<li><a href="#21">2.1</a>
<ul>
<li><a href="#result">Result</a></li>
</ul>
</li>
<li><a href="#22">2.2</a>
<ul>
<li><a href="#221">2.2.1</a></li>
<li><a href="#222">2.2.2</a>
<ul>
<li><a href="#2221">2.2.2.1</a></li>
<li><a href="#results">Results</a></li>
</ul>
</li>
<li><a href="#223">2.2.3</a></li>
<li><a href="#224">2.2.4</a></li>
<li><a href="#225">2.2.5</a>
<ul>
<li><a href="#result-1">Result</a></li>
</ul>
</li>
<li><a href="#226">2.2.6</a>
<ul>
<li><a href="#result-2">Result</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#23">2.3</a>
<ul>
<li><a href="#231">2.3.1</a></li>
</ul>
</li>
<li><a href="#24">2.4</a>
<ul>
<li><a href="#result-3">Result</a></li>
</ul>
</li>
<li><a href="#25">2.5</a>
<ul>
<li><a href="#result-4">Result</a></li>
</ul>
</li>
<li><a href="#26">2.6</a></li>
<li><a href="#27">2.7</a>
<ul>
<li><a href="#results-1">Results</a></li>
</ul>
</li>
<li><a href="#report-details">Report details</a>
<ul>
<li><a href="#inspect-server">Inspect server</a></li>
<li><a href="#containers-list">Containers list</a></li>
<li><a href="#system-stats">System stats</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="21">2.1</h2>
<p>First we need to pull redis image and make container from pulled image</p>
<pre><code class="language-bash">docker pull redis
docker run --name redis_net -d redis
</code></pre>
<h3 id="result">Result</h3>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/redis.png" alt="redis"></p>
<h2 id="22">2.2</h2>
<p>In this step we will create Django project and app and make image from it.
then push this image to docker hub.</p>
<h3 id="221">2.2.1</h3>
<p>Create a Django project</p>
<pre><code class="language-bash">django-admin startproject crypto
</code></pre>
<h3 id="222">2.2.2</h3>
<p>Create a Django app</p>
<pre><code class="language-bash"><span class="hljs-built_in">cd</span> crypto
python manage.py startapp cryptoApp
</code></pre>
<h4 id="2221">2.2.2.1</h4>
<p>Create a class in <a href="./crypto/cryptoApp/views.py">Views.py</a> file
for get data from API and show it to user</p>
<p>and create a <a href="./crypto/cryptoApp/urls.py">urls.py</a> file for routing</p>
<p>create Serializer class in <a href="./crypto/cryptoApp/serializers.py">serializers.py</a> file for serialize data</p>
<p>change <a href="./crypto/crypto/settings.py">settings.py</a> file for add app</p>
<p>and add <a href="./crypto/crypto/urls.py">urls.py</a> file for routing</p>
<h4 id="results">Results</h4>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/django.png" alt="Django"></p>
<h3 id="223">2.2.3</h3>
<p>Create a requirements.txt</p>
<pre><code class="language-bash">Django==4.1.4
django-cors-headers==3.13.0
djangorestframework==3.13.1
requests==2.26.0
requests-toolbelt==0.9.1
requests-unixsocket==0.2.0
redis==3.5.3
</code></pre>
<h3 id="224">2.2.4</h3>
<p>Create a Dockerfile in crypto directory
and run Django server</p>
<pre><code class="language-bash">FROM python:3.8
ENV PYTHONUNBUFFERED 1
RUN <span class="hljs-built_in">mkdir</span> /code
WORKDIR /code
COPY requirements.txt /code/
RUN pip install -r requirements.txt
COPY . /code/
CMD python manage.py runserver

</code></pre>
<h3 id="225">2.2.5</h3>
<p>Make image from Dockerfile</p>
<pre><code class="language-bash">docker build -t crypto .
</code></pre>
<h4 id="result">Result</h4>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/build-image.png" alt="Build"></p>
<h3 id="226">2.2.6</h3>
<p>Push image to docker hub</p>
<pre><code class="language-bash">docker tag crypto:latest mohamadch91/crypto:latest
docker push mohamadch91/crypto:latest
</code></pre>
<h4 id="result">Result</h4>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/tag-image.png" alt="Build">
<img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/push-image.png" alt="Build">
<img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/dockehub.png" alt="Build"></p>
<h2 id="23">2.3</h2>
<p>In this step we need to create config file for Django and redis</p>
<p>Create a .env file for Django and redis in Dockerfile</p>
<pre><code class="language-bash">CACHE_TTL=300
REDIS_HOST=redis
REDIS_PORT=6379
DJANGO_PORT=8000
COINAPI_KEY=YOUR_API
</code></pre>
<h4 id="231">2.3.1</h4>
<p>Change <a href="./crypto/crypto/settings.py">setting.py</a> file for env</p>
<pre><code class="language-python">
runserver.default_port = os.environ.get(<span class="hljs-string">&#x27;DJANGO_PORT&#x27;</span>, <span class="hljs-string">&#x27;8001&#x27;</span>)

COINAPI_KEY = os.environ.get(<span class="hljs-string">&#x27;COINAPI_KEY&#x27;</span>, <span class="hljs-string">&#x27;Your key&#x27;</span>)

CACHE_TTL=os.environ.get(<span class="hljs-string">&#x27;CACHE_TTL&#x27;</span>, <span class="hljs-string">&#x27;350&#x27;</span>)

</code></pre>
<h2 id="24">2.4</h2>
<p>In this step we need to create volumes for redis</p>
<pre><code>```bash
docker volume create redis_data
```
</code></pre>
<h3 id="result">Result</h3>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/volume-create.png" alt="volume cretae"></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/volume-ls.png" alt="volume ls"></p>
<h2 id="25">2.5</h2>
<p>In this step we need to create network for redis and Django</p>
<pre><code class="language-bash">docker network create crypto
</code></pre>
<h3 id="result">Result</h3>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/network.png" alt="network create"></p>
<h2 id="26">2.6</h2>
<p>now we need to write docker-compose.yml file for run redis and Django
to volume and network</p>
<ul>
<li><a href="./crypto/docker-compose.yml">compose file</a></li>
</ul>
<h2 id="27">2.7</h2>
<p>now we run de compose file</p>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<h3 id="results">Results</h3>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/compose-up.png" alt="compuse up"></p>
<ul>
<li><a href="./crypto/.env">env file</a></li>
</ul>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/env.png" alt="env"></p>
<p>we see upcoming on port 8005</p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/app.png" alt="app"></p>
<p><strong>Get btc data</strong></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/getAPI.png" alt="BTC"></p>
<p><strong>Get btc for second time</strong></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/cache-redis.png" alt="BTC Second"></p>
<p><strong>Remove redis</strong></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/remove-redis.png" alt="Redis remove"></p>
<p><strong>API response on no redis</strong></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/redis-removed.png" alt="No redis API"></p>
<p><strong>Start again redis and check API</strong></p>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/cache-no-redis.png" alt="After redis remove"></p>
<h2 id="report-details">Report details</h2>
<h3 id="inspect-server">Inspect server</h3>
<p>Inspect server image with</p>
<pre><code class="language-bash">docker image inspect mohamadch91/crypto
</code></pre>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/inspect1.png" alt="image 1">
<img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/inspect2.png" alt="image 2"></p>
<h3 id="containers-list">Containers list</h3>
<p>get list of containers</p>
<pre><code class="language-bash">docker ps

</code></pre>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/ps.png" alt="containers"></p>
<h3 id="system-stats">System stats</h3>
<p>get status of system with</p>
<pre><code class="language-bash">
docker stats

</code></pre>
<p><img src="file:////mnt/mamads/uni/7/Cloud/HW/cloudCompunting-HWs/HW2/step_two/images/stats.png" alt="stats"></p>

        
        
    </body>
    </html>